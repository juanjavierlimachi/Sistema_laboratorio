<div class="table-responsive">
<div class="btn-group">
  <button data-toggle="dropdown" class="btn btn-primary dropdown-toggle btn-sm" type="button" aria-expanded="false">OPCIONES    <span class="caret"></span>
  </button>
  <ul role="menu" class="dropdown-menu">
      	<li><a href="#" data-toggle="modal" onclick="detalleClient('/update-client/{{cliente.id}}','EDITAR LOS DATOS DEL CLIENTE')" data-target="#exampleModal">Editar Datos Del Cliente</a></li>
       	<li><a href="#" data-toggle="modal" id=myModal onclick="detalleClient('/RegisterNewProductAndResult/{{cliente.id}}','AGREGAR NUEVO PAQUETE')" data-target="#exampleModal">Registrar paquete</a></li>
  </ul>
</div>
<table class="table table-hover table-striped">
	<tr class="success">
		<td align="center" colspan="6"><strong>REPORTE DE ANALISIS</strong></td>
		<td style="color:red"> Nro. CERT. {{cliente.id}}</td><td></td>
	</tr>
	<tr>
		<td colspan="5"><br><strong>PERTENECIENTE A:</strong> {{cliente.Nombre|upper}}</td>
		<td colspan="1"><br><strong>TELÉFONO:</strong> {{cliente.Telefono|default_if_none:"--"}}</td>
		<td colspan="2"><br><strong>DIRECCIÓN:</strong> {{cliente.Direccion}}</td>
	</tr>
	<tr><td colspan="4"><br><strong>NIT: </strong>{{cliente.Nit|default_if_none:"--"}}</td>
		<td colspan="2"><br><strong>Fecha de Registro:</strong> {{cliente.fecha_registro|date:"l d M Y"}}</td>
		<td><br><strong>Cliente: </strong>{% if cliente.Particular %}Particular{% else %}Empresa{% endif %}</td>
		<td colspan="1"><br>Estado:  {% if cliente.estado %}
				<strong style="color:green">Activo</strong>
			{% else %}
				<strong style="color:red">Baja</strong>
			{% endif %}</td>
	</tr>
</table>
<table class="table table-striped table-bordered">
	<thead  class="success">
		<th style="width: 3%;">Nro</th>
		<th>FECHA</th>
		<th>LOTE</th>

	</thead >
	<tbody>
	{% for i in productos %}
	<tr>
		<td>{{forloop.counter}}</td>
		<td>{{i.fecha_registro|date:"l d M Y"}}</td>
		<td>{{i.Lote|upper}}</td>
		<td>{{i.ingreso.all.count}}</td>
		<td>
			{% if i.estado %}
			<button type="button" class="btn btn-success btn-xs" onclick="detalleClient('/RegisterResultados/{{i.id}}','REGISTRAR MUESTRA DE MINERAL DE: {{i.Cliente.Nombre|upper}}')" data-toggle="modal" data-target=".bd-example-modal-lg">Resultados</button>
				{% if user.is_superuser %}
					<button type="button" class="btn btn-info btn-xs" onclick="detalleClient('update-product/{{i.id}}','Editar el paquete: {{i.Lote|upper}}')" data-toggle="modal" data-target="#exampleModal">Editar</button>
				{% endif %}
			{% else %}
			<button type="button" class="btn btn-danger btn-xs" onclick="restoreProduct('/restore-producto/{{i.id}}',' ')">Restaurar</button>
			{% endif %}
		</td>
		<td>
			{% if i.estado %}
			<input type="checkbox"  name="checks[]" value="{{i.id}}" id="id_product">
			{% endif %}
		</td>
	</tr>
	{% empty %}
	<tr> <td colspan="5" align="center"><strong>Aún no tiene paquetes registrados: registre aqui: </strong><a href="#" data-toggle="modal" id=myModal onclick="detalleClient('/RegisterNewProductAndResult/{{cliente.id}}','')" data-target="#exampleModal">Registrar paquete</a></td> </tr>
	{% endfor %}
		{% if productos.count > 0 %}
		<tr><td colspan="5"></td><td><button type="button" href="#" id="print"onclick="printCertify()" class="btn btn-warning" >Imprimir</button></td></tr>
		{% endif %}
	</tbody>
</table>
</div>
<script type="text/javascript">
	$(document).ready(function(){
		$("#myModal").trigger("click");
	} );
	function detalleClient(route,title){
		$(".modal-title").text(title);
        $.ajax({
            type:'GET',
            url:route,
            success:function(resp){
                $(".modal-body").html(resp);  
            }
        });
	}
	function restoreProduct(route,title){
        $.ajax({
          type:'GET',
          url: route,
          success:function(resp){
            $('.x_content').html(resp);
			/*
fix this part because when I'm restoring a product it shows and hides the modal
***
To fix, you need to send the request to a url, then create a template that will display the product data.
*/
			$(".modal .close").click();
          }
        });
	}
	var listIdProduct;
	$('[name="checks[]"]').click(function() {
      
	  var arr = $('[name="checks[]"]:checked').map(function(){
		return this.value;
	  }).get();
	  
	  listIdProduct = arr.join(',');
	  
	  //console.log(JSON.stringify(arr));
	  
	  //console.log(str);
	
	});
	function printCertify(){
		if(listIdProduct.length === 0){
			alert('Seleccione almenos un paquetes');
		}else{
			window.open("print-certify/"+listIdProduct+"/");
		}
	}
</script>